<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!--
    <script src="http://openlayers.org/dev/OpenLayers.js"></script>
-->
    <script src="{{=URL('static','openlayers/OpenLayers.js')}}" type="text/javascript"></script>
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
-->
    <script src="{{=URL('static','js/jquery.js')}}" type="text/javascript"></script>
<!--
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.min.js" type="text/javascript"></script>
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
-->
    <script src="http://maps.google.com/maps/api/js?v=3.6&amp;sensor=false"></script>
<!--
    <script src="http://mercatorlab.com/proj4js/lib/proj4js-compressed.js"></script>
-->
    <script src="{{=URL('static','proj4js/lib/proj4js-compressed.js')}}" type="text/javascript"></script>
    <script type="text/javascript">
        Proj4js.defs["EPSG:32718"] = "+proj=utm +zone=18 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
        var wgs84Projection = new OpenLayers.Projection("EPSG:4326");
        var sphericalMProjection = new OpenLayers.Projection("EPSG:900913");
        var utmProjection = new OpenLayers.Projection("EPSG:32718"); 
        var lon = -75.88400,
            lat = -8.0078125,
            zoom = 8;
        var layer_data = new Array();

       function init(){
            var map = new OpenLayers.Map('map', {
                units: 'm',
                numZoomLevels: 19,
                controls: [
                    //new OpenLayers.Control.Graticule({
                        //numPoints: 2, 
                        //labelled: true,
                        //visible: false,
                        //layerName: 'Rejilla',
                        //displayInLayerSwitcher: true
                    //}),
                    //new OpenLayers.Control.PanZoomBar(),
                    new OpenLayers.Control.PanZoom(),
                    new OpenLayers.Control.Navigation(),
                    new OpenLayers.Control.ScaleLine(),
                    //new OpenLayers.Control.MousePosition(),
                    //new OpenLayers.Control.LayerSwitcher()
                ],
                //allOverlays: true,
                //minScale: 100, 
                projection: sphericalMProjection,
                displayProjection: wgs84Projection //Is used for displaying coordinates in appropriate CRS by MousePosition control
            });

            //map.addControl(new OpenLayers.Control.PanZoom());
            map.addControl(new OpenLayers.Control.KeyboardDefaults());
            //var ctrlNav = new OpenLayers.Control.Navigation();
            //ctrlNav.zoomWheelEnabled = false;
            //map.addControl(ctrlNav);
            map.addControl(new OpenLayers.Control.LayerSwitcher( {title: 'View Layers'} ));
            //map.addControl(new OpenLayers.Control.ScaleLine());
            var ctrl = new OpenLayers.Control.MousePosition();
            ctrl.displayProjection = utmProjection;
            map.addControl(ctrl);

            layer_data[0] = new OpenLayers.Layer.Google('Google Satelite', {
                type: google.maps.MapTypeId.SATELLITE,
                visibility: false,
                sphericalMercator: true
            });

            layer_data[1] = new OpenLayers.Layer.Bing({
                name: "Bing Aerial Layer",
                type: "Aerial",
                key: "AuWxq-E5tYJ_crQikiGqG8uXU7z7ANMLkCjr6UcJnaKRZAPmxdNwhD4UX2GEJTKq",
            });

            //var void_layer = new OpenLayers.Layer.OSM();
            {{counter = 2}}
            {{for layer in layer_data:}}
            layer_data[{{=counter}}] = new OpenLayers.Layer.Vector("{{=layer.name}}", {
                projection: utmProjection,
                displayProjection : wgs84Projection,
                visibility: false,
                style: {
                    'fillColor': '{{=layer.color_fill}}',
                    'fillOpacity': .6,
                    'strokeColor': '{{=layer.color_line}}',
                    'strokeWidth': 1,
                    'pointRadius': 8
                },
                strategies: [new OpenLayers.Strategy.Fixed()],
                protocol: new OpenLayers.Protocol.HTTP({
                    //url: "{{=URL('static','data/zonificacion_pncaz.geojson')}}",
                    url: "../static/data/{{=layer.file_data}}",
                    format: new OpenLayers.Format.GeoJSON()
                }),
            });
            {{counter += 1}}
            {{pass}}


//AGREGAR AQUI EL NOMBRE DE LA CAPA, separada por comas
            map.addLayers(layer_data);
            map.setCenter(new OpenLayers.LonLat(lon, lat).transform(wgs84Projection, sphericalMProjection), zoom);


        var selectControl = new OpenLayers.Control.SelectFeature(layer_data[4], {
            hover: true,
            onSelect: function(feature) {
                var layer = feature.layer;
                feature.style.fillOpacity = 1;
                feature.style.pointRadius = 20;
                layer.drawFeature(feature);
                
                var content = "<div><strong>Poblacion:</strong> <br/>" + feature.data.NOMBRE +
                    "<br/><br/><strong>Longitud:</strong> <br/>" + feature.geometry.x +  +"</div>" +
                    "<br/><br/><strong>Latitud:</strong> <br/>" + feature.geometry.POINT +  +"</div>"
                    ;
                console.log(feature);
                //var content = feature;
                var popup = new OpenLayers.Popup.FramedCloud(
                    feature.id+"_popup", 
                    feature.geometry.getBounds().getCenterLonLat(),
                    new OpenLayers.Size(250, 100),
                    content,
                    null, 
                    false, 
                    null);
                feature.popup = popup;
                map.addPopup(popup);
            },
            onUnselect: function(feature) {
                var layer = feature.layer;
                feature.style.fillOpacity = 0.7;
                feature.style.pointRadius = 16;
                feature.renderIntent = null;
                layer.drawFeature(feature);                
                  map.removePopup(feature.popup);
            }
        });
        map.addControl(selectControl);
        selectControl.activate();
        }
    </script>
  </head>
  <body onload="init()">
    <div id="map" style="position: absolute; right: 0px; top: 0px; width: 100%; height: 100%"></div>
  </body>
</html>
